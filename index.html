<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Villa Kunterbunt Kellerlüftungsberater</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* -- Base & M3 Typography -- */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
            background-color: var(--surface, #111827);
            color: var(--on-surface, #e5e7eb);
            transition: background-color 0.5s ease;
        }
        .display-small { font-size: 36px; line-height: 44px; font-weight: 400; }
        .headline-medium { font-size: 28px; line-height: 36px; font-weight: 400; }
        .title-large { font-size: 22px; line-height: 28px; font-weight: 500; }
        .label-large { font-size: 14px; line-height: 20px; font-weight: 500; }
        .body-medium { font-size: 14px; line-height: 20px; font-weight: 400; }

        /* -- Transitions -- */
        .seasonal-card, .seasonal-accent, input[type="range"]::-webkit-slider-thumb, #seasonal-image {
            transition: background-color 0.5s ease, color 0.5s ease, border-color 0.5s ease;
        }

        /* -- M3 Seasonal Color Palettes -- */
        .season-winter {
            --surface: #1a1c1e;
            --surface-container: #1e2022;
            --surface-container-high: #292a2d;
            --primary: #a1c9ff;
            --on-primary: #00325a;
            --on-surface: #e2e2e6;
            --on-surface-variant: #c2c7ce;
        }
        .season-spring {
            --surface: #1a1c19;
            --surface-container: #1e201d;
            --surface-container-high: #292b28;
            --primary: #83d98f;
            --on-primary: #003913;
            --on-surface: #e2e3de;
            --on-surface-variant: #c1c8be;
        }
        .season-summer {
            --surface: #1e1b16;
            --surface-container: #221f1a;
            --surface-container-high: #2d2a24;
            --primary: #efc149;
            --on-primary: #3f2e00;
            --on-surface: #e8e2d9;
            --on-surface-variant: #ceca M-2-digit;
        }
        .season-autumn {
            --surface: #201a18;
            --surface-container: #241e1c;
            --surface-container-high: #2f2826;
            --primary: #ffb59c;
            --on-primary: #55200c;
            --on-surface: #ede0dc;
            --on-surface-variant: #d6c3be;
        }

        /* -- Applying Variables -- */
        .seasonal-card { background-color: var(--surface-container); }
        .seasonal-accent { color: var(--primary); }
        .seasonal-text-secondary { color: var(--on-surface-variant); }
        #seasonal-image { border-color: var(--primary); }

        /* -- M3 Components -- */
        /* Switch */
        .switch { width: 52px; height: 32px; background-color: var(--surface-container-high); border-radius: 100px; position: relative; }
        .switch-thumb { width: 24px; height: 24px; background-color: #8e9094; border-radius: 50%; position: absolute; top: 4px; left: 4px; transition: transform 0.25s ease, background-color 0.25s ease; }
        .mode-switch:checked + .switch .switch-thumb { transform: translateX(20px); background-color: var(--on-primary); }
        .mode-switch:checked + .switch { background-color: var(--primary); }

        /* Slider */
        input[type="range"] { -webkit-appearance: none; width: 100%; height: 4px; background-color: var(--surface-container-high); border-radius: 2px; cursor: pointer; }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none;
            width: 20px; height: 20px; border-radius: 50%;
            background-color: var(--primary);
            border: none;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px; height: 20px; border-radius: 50%; cursor: pointer;
            background-color: var(--primary);
            border: none;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-md mx-auto">
        <header class="text-center mb-8">
            <!-- New Seasonal Image Container -->
            <div id="seasonal-image-container" class="mb-6 flex justify-center">
                <img id="seasonal-image" src="" alt="Seasonal visual" class="w-32 h-32 rounded-full object-cover border-4 shadow-lg">
            </div>
            <h1 id="main-title" class="headline-medium seasonal-accent">Villa Kunterbunt Kellerlüftungsberater</h1>
            <p class="mt-2 body-medium seasonal-text-secondary">Get smart advice on when to open your windows.</p>
        </header>

        <!-- Input Controls Card -->
        <div class="p-6 rounded-[28px] shadow-2xl seasonal-card">
            <!-- Mode Switch -->
            <div class="flex items-center justify-center space-x-4 mb-6">
                <span class="label-large seasonal-text-secondary">Manual</span>
                <label for="mode-switch" class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="mode-switch" class="sr-only mode-switch">
                    <div class="switch">
                        <div class="switch-thumb"></div>
                    </div>
                </label>
                <span class="label-large" style="color: var(--on-surface);">Auto (Live Weather)</span>
            </div>

            <!-- Auto Mode View -->
            <div id="auto-mode" class="hidden">
                 <div class="text-center mb-4">
                    <p class="title-large" style="color: var(--on-surface);">Weather for Thun, Switzerland</p>
                    <p id="loading-message" class="body-medium seasonal-accent">Fetching live weather data...</p>
                 </div>
                 <div id="weather-data-container" class="hidden space-y-4">
                    <div class="bg-black/20 p-4 rounded-2xl">
                        <div class="flex justify-between items-center text-center">
                             <div>
                                <p class="display-small" style="color: var(--on-surface);"><span id="auto-temp-out">--</span>°</p>
                                <p class="label-large seasonal-text-secondary">Outside</p>
                             </div>
                             <div>
                                <p class="display-small" style="color: var(--on-surface);"><span id="auto-rh-out">--</span>%</p>
                                <p class="label-large seasonal-text-secondary">Humidity</p>
                            </div>
                        </div>
                    </div>
                     <div>
                        <label for="basement-temp-auto" class="block label-large text-gray-300 mb-2">Your Basement Temperature</label>
                        <div class="flex items-center space-x-4">
                            <input type="range" id="basement-temp-auto" min="0" max="30" value="20" step="0.5">
                            <span id="basement-temp-auto-value" class="font-bold text-lg w-16 text-center" style="color: var(--on-surface);">20°C</span>
                        </div>
                    </div>
                 </div>
            </div>
            
            <!-- Manual Mode View -->
            <div id="manual-mode" class="space-y-4">
                <div>
                    <label for="temp-in" class="block label-large text-gray-300 mb-2">Basement Temperature</label>
                    <div class="flex items-center space-x-4">
                        <input type="range" id="temp-in" min="0" max="30" value="20" step="0.5">
                        <span id="temp-in-value" class="font-bold text-lg w-16 text-center" style="color: var(--on-surface);">20°C</span>
                    </div>
                </div>
                <div>
                    <label for="temp-out" class="block label-large text-gray-300 mb-2">Outside Temperature</label>
                    <div class="flex items-center space-x-4">
                        <input type="range" id="temp-out" min="-10" max="35" value="15" step="0.5">
                        <span id="temp-out-value" class="font-bold text-lg w-16 text-center" style="color: var(--on-surface);">15°C</span>
                    </div>
                </div>
                <div>
                    <label for="rh-out" class="block label-large text-gray-300 mb-2">Outside Relative Humidity</label>
                    <div class="flex items-center space-x-4">
                        <input type="range" id="rh-out" min="20" max="100" value="89" step="1">
                        <span id="rh-out-value" class="font-bold text-lg w-16 text-center" style="color: var(--on-surface);">89%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Context Card -->
        <div id="context-card" class="p-6 rounded-[28px] shadow-2xl mt-6 seasonal-card">
            <h2 class="title-large text-center mb-4" style="color: var(--on-surface);">Current Context</h2>
            <div class="flex justify-between text-center border-b pb-3 mb-3" style="border-color: var(--surface-container-high);">
                <div>
                    <p class="label-large seasonal-text-secondary">Time</p>
                    <p id="current-time" class="font-semibold text-lg" style="color: var(--on-surface);">--:--</p>
                </div>
                <div>
                    <p class="label-large seasonal-text-secondary">Season</p>
                    <p id="current-season" class="font-semibold text-lg" style="color: var(--on-surface);">--</p>
                </div>
                <div>
                    <p class="label-large seasonal-text-secondary">Temp Trend</p>
                    <p id="expected-trend" class="font-semibold text-lg" style="color: var(--on-surface);">--</p>
                </div>
            </div>
            <div id="dynamic-advisor-container" class="flex items-start space-x-3 seasonal-text-secondary">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="flex-shrink-0 mt-0.5"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                <p id="dynamic-advisor-text" class="body-medium">Loading dynamic advice...</p>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results-card" class="p-6 rounded-[28px] shadow-2xl mt-6 seasonal-card">
            <h2 class="title-large text-center mb-4" style="color: var(--on-surface);">Outcome</h2>
            <div class="text-center mb-4">
                <p class="label-large seasonal-text-secondary">Expected Basement Humidity</p>
                <p id="final-humidity" class="display-small seasonal-accent">--%</p>
            </div>
            <div id="recommendation-box" class="flex items-center p-4 rounded-xl transition-all duration-300">
                <div id="recommendation-icon" class="mr-4"></div>
                <div>
                    <h3 id="recommendation-title" class="title-large"></h3>
                    <p id="recommendation-summary" class="body-medium"></p>
                </div>
            </div>
        </div>
    </div>

<script>
    // --- DOM ELEMENTS ---
    const body = document.body;
    const modeSwitch = document.getElementById('mode-switch');
    const autoModeDiv = document.getElementById('auto-mode');
    const manualModeDiv = document.getElementById('manual-mode');
    const seasonalImage = document.getElementById('seasonal-image');
    
    // Manual Inputs
    const tempInSlider = document.getElementById('temp-in');
    const tempOutSlider = document.getElementById('temp-out');
    const rhOutSlider = document.getElementById('rh-out');
    const tempInValue = document.getElementById('temp-in-value');
    const tempOutValue = document.getElementById('temp-out-value');
    const rhOutValue = document.getElementById('rh-out-value');

    // Auto Inputs & Displays
    const basementTempAutoSlider = document.getElementById('basement-temp-auto');
    const basementTempAutoValue = document.getElementById('basement-temp-auto-value');
    const autoTempOutDisplay = document.getElementById('auto-temp-out');
    const autoRhOutDisplay = document.getElementById('auto-rh-out');
    const loadingMessage = document.getElementById('loading-message');
    const weatherDataContainer = document.getElementById('weather-data-container');

    // Context Card
    const currentTimeDisplay = document.getElementById('current-time');
    const currentSeasonDisplay = document.getElementById('current-season');
    const expectedTrendDisplay = document.getElementById('expected-trend');
    const dynamicAdvisorText = document.getElementById('dynamic-advisor-text');
    const dynamicAdvisorContainer = document.getElementById('dynamic-advisor-container');

    // Results
    const finalHumidityDisplay = document.getElementById('final-humidity');
    const mainTitle = document.getElementById('main-title');
    const recommendationBox = document.getElementById('recommendation-box');
    const recommendationIcon = document.getElementById('recommendation-icon');
    const recommendationTitle = document.getElementById('recommendation-title');
    const recommendationSummary = document.getElementById('recommendation-summary');

    // --- SVG ICONS ---
    const ICONS = {
        good: `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path></svg>`,
        bad: `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M10 15v7a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h3a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2h-3"></path></svg>`,
        warning: `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><line x1="12" x2="12" y1="9" y2="13"></line><line x1="12" x2="12.01" y1="17" y2="17"></line></svg>`
    };

    // --- CORE LOGIC ---
    function calculateFinalHumidity(tempIn, tempOut, rhOut) {
        const calcEs = (temp) => 6.112 * Math.exp((17.67 * temp) / (temp + 243.5));
        const esOut = calcEs(tempOut);
        const eOut = esOut * (rhOut / 100);
        const esIn = calcEs(tempIn);
        const finalRh = (eOut / esIn) * 100;
        return Math.min(100, Math.round(finalRh));
    }

    function calculateDewPoint(temp, rh) {
        const a = 17.625;
        const b = 243.04;
        const alpha = Math.log(rh / 100) + (a * temp) / (b + temp);
        const dewPoint = (b * alpha) / (a - alpha);
        return dewPoint;
    }
    
    function updateUI() {
        let tempIn, tempOut, rhOut;
        updateContextualInfo(); 

        if (modeSwitch.checked) {
            tempIn = parseFloat(basementTempAutoSlider.value);
            tempOut = parseFloat(autoTempOutDisplay.textContent);
            rhOut = parseFloat(autoRhOutDisplay.textContent);
            if (isNaN(tempOut) || isNaN(rhOut)) return;
        } else {
            tempIn = parseFloat(tempInSlider.value);
            tempOut = parseFloat(tempOutSlider.value);
            rhOut = parseFloat(rhOutSlider.value);
        }

        const finalHumidity = calculateFinalHumidity(tempIn, tempOut, rhOut);
        const dewPointOut = calculateDewPoint(tempOut, rhOut);
        finalHumidityDisplay.textContent = `${finalHumidity}%`;

        let rec = {};
        if (dewPointOut >= tempIn - 1.5) { // Slightly more sensitive buffer
            rec = { title: "Do Not Ventilate!", summary: `High condensation risk. The outside air is too moist (${dewPointOut.toFixed(1)}°C dew point).`, color: 'bg-red-500/20 text-red-300', icon: ICONS.bad };
        } else if (tempOut > tempIn) {
            rec = { title: "Do Not Ventilate!", summary: `The outside air is warmer. This will heat your basement and likely add moisture.`, color: 'bg-red-500/20 text-red-300', icon: ICONS.bad };
        } else if (finalHumidity < 60) {
            rec = { title: "Yes, Ventilate!", summary: `Ideal conditions. You will effectively cool and dehumidify your basement.`, color: 'bg-green-500/20 text-green-300', icon: ICONS.good };
        } else if (finalHumidity < 75) {
            rec = { title: "Ventilate with Caution", summary: `This will help cool, but won't significantly lower humidity. Safe from condensation.`, color: 'bg-yellow-500/20 text-yellow-300', icon: ICONS.warning };
        } else {
            rec = { title: "Do Not Ventilate", summary: `This will make your basement more humid. The final humidity is too high.`, color: 'bg-red-500/20 text-red-300', icon: ICONS.bad };
        }
        
        recommendationTitle.textContent = rec.title;
        recommendationSummary.textContent = rec.summary;
        recommendationBox.className = `flex items-center p-4 rounded-xl transition-all duration-300 ${rec.color}`;
        recommendationIcon.innerHTML = rec.icon;
    }

    // --- CONTEXT & DYNAMIC ADVISOR ---
    function applySeasonalTheme(season) {
        body.className = body.className.replace(/season-\w+/g, '');
        if (season) {
            body.classList.add(`season-${season.toLowerCase()}`);
            seasonalImage.src = `./images/${season.toLowerCase()}.png`;
        }
    }

    function getSeason(d) {
        const month = d.getMonth();
        if (month < 2 || month === 11) return 'Winter';
        if (month >= 2 && month < 5) return 'Spring';
        if (month >= 5 && month < 8) return 'Summer';
        return 'Autumn';
    }

    function updateContextualInfo() {
        const now = new Date();
        const hour = now.getHours();
        const season = getSeason(now);
        
        applySeasonalTheme(season);
        currentTimeDisplay.textContent = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        currentSeasonDisplay.textContent = season;

        let hint = "General Tip: Ventilate when outside is cooler and the dew point is lower than your basement's temperature.";
        let trend = "Stable";
        
        if ((season === 'Summer' || season === 'Spring') && (hour > 4 && hour < 12)) {
            trend = "Rising ↗";
        } else if (hour > 17 || hour < 3) {
            trend = "Falling ↘";
        }
        expectedTrendDisplay.textContent = trend;
        
        dynamicAdvisorContainer.classList.remove('seasonal-accent');
        dynamicAdvisorText.classList.remove('font-bold');

        if (season === 'Winter') {
            hint = "Hint: It's winter. Ventilating now is great for introducing fresh, dry air, though you will lose some heat.";
        } else if (trend === "Falling ↘" && hour > 17) {
            hint = "Hint: It's evening and temps are falling. This is often the best time to cool down your home for the night.";
        }

        let tempIn, tempOut;
        if (modeSwitch.checked) {
            tempIn = parseFloat(basementTempAutoSlider.value);
            tempOut = parseFloat(autoTempOutDisplay.textContent);
        } else {
            tempIn = parseFloat(tempInSlider.value);
            tempOut = parseFloat(tempOutSlider.value);
        }

        if (!isNaN(tempIn) && !isNaN(tempOut) && season === 'Summer' && trend === "Rising ↗" && tempOut < tempIn) {
            hint = `Warning: Summer morning. Outside temp is rising. Ventilating now could trap heat and moisture later.`;
            dynamicAdvisorContainer.classList.add('seasonal-accent');
            dynamicAdvisorText.classList.add('font-bold');
        }
        
        dynamicAdvisorText.textContent = hint;
    }

    // --- EVENT LISTENERS ---
    function setupEventListeners() {
        [tempInSlider, tempOutSlider, rhOutSlider].forEach(slider => {
            slider.addEventListener('input', () => {
                tempInValue.textContent = `${tempInSlider.value}°C`;
                tempOutValue.textContent = `${tempOutSlider.value}°C`;
                rhOutValue.textContent = `${rhOutSlider.value}%`;
                updateUI();
            });
        });

        basementTempAutoSlider.addEventListener('input', () => {
             basementTempAutoValue.textContent = `${basementTempAutoSlider.value}°C`;
             updateUI();
        });

        modeSwitch.addEventListener('change', () => {
            if (modeSwitch.checked) {
                autoModeDiv.classList.remove('hidden');
                manualModeDiv.classList.add('hidden');
                fetchWeatherData();
            } else {
                autoModeDiv.classList.add('hidden');
                manualModeDiv.classList.remove('hidden');
                updateUI();
            }
        });
    }

    // --- API & AUTO MODE LOGIC ---
    function fetchWeatherData() {
        loadingMessage.classList.remove('hidden');
        weatherDataContainer.classList.add('hidden');

        setTimeout(() => {
            const mockWeatherData = { main: { temp: 16.5, humidity: 92 } };
            autoTempOutDisplay.textContent = mockWeatherData.main.temp.toFixed(1);
            autoRhOutDisplay.textContent = mockWeatherData.main.humidity;
            loadingMessage.classList.add('hidden');
            weatherDataContainer.classList.remove('hidden');
            updateUI();
        }, 1500);
    }

    // --- INITIALIZATION ---
    function initialize() {
        setupEventListeners();
        updateUI(); 
        setInterval(updateContextualInfo, 60000); 
    }

    initialize();
</script>

</body>
</html>

